<h2> Review scores: <%= Participant.find(@reviewer_id).name(session[:ip]) %> </h2>

<% keys = @review_final_versions.keys %>
<% keys.each do |key| %>

    <h4>Course: <%= Assignment.find(@assignment_id).course.name %></h4>
    <h4> Assignment: <%= Assignment.find(@assignment_id).name %></h4>
    <% roundtitle = key.to_s %>
    <h4><%= roundtitle.titlecase %></h4>

    <table class="general" border="1">
      <% questionnaire_id = Questionnaire.find(@review_final_versions[key][:questionnaire_id]) %>
      <% questions = Question.where(questionnaire_id: questionnaire_id) %>
      <% num_responses = @review_final_versions[key][:response_ids].length %>
      <% responses = @review_final_versions[key][:response_ids] %>
<!--      set column length of responses-->
      <% col_percent = 100/num_responses%>
      <% col_percent_comment = 100/num_responses - 1%>
      <!-- show the team which did the review -->
      <tr>
        <th colspan="3" style="background-color:#DDDDBB" width="<%= col_percent %>%" >[question] </th>
        <td colspan="3" style="padding: 0px;" width="(100-<%= col_percent %>)%">
          <table width="100%">
            <tr>
              <% responses.each do |response_id| %>
                  <% team = Team.find(ResponseMap.find(Response.find(response_id).map_id).reviewee_id) %>
                  <td width="<%= col_percent %>%" align="center"><%= team.name(session[:ip]) %></td>
              <% end %>
            </tr>
          </table>
        </td>

      </tr>


      <% questions.each do |question| %>
          <% if !question.is_a?(QuestionnaireHeader) && num_responses > 0 %>
              <tr>
                <th colspan="3" style="background-color:#DDDDBB" width="<%= col_percent %>%" > <%= question.txt %></th>
                <% if question.instance_of? Checkbox %>
                    <!-- Show review summary of checkbox question -->
                    <td colspan="3" style="padding: 0px;" width="100-<%= col_percent %>%">
                      <%= render :partial => 'checkbox_question_review', :locals => {:question => question, :responses => responses} %>
                    </td>
                <% else %>
                    <!-- show review summary for non-checkbox question -->
                    <td colspan="3" style="padding: 0px;" width="100-<%= col_percent %>%">
                      <%= render :partial => 'non_checkbox_question_review', :locals => {:question => question, :responses => responses, :col_percent => col_percent, :col_percent_comment => col_percent_comment} %>
                    </td>
                <% end %>
              </tr>
          <% else %>
              <% next %>
          <% end %>
      <% end %>
      <tr>
        <th align='left' colspan="3" style="background-color:#DDDDBB" width="<%= col_percent %>%"> Additional Comment</th>
        <td colspan="3" style="padding: 0px;" width="100-<%= col_percent %>%">
          <table width="100%">
            <tr>
              <% responses.each do |response_id| %>
                  <% team = Team.find(ResponseMap.find(Response.find(response_id).map_id).reviewee_id) %>
                  <td width="<%= col_percent %>%"> <%=sanitize Response.find(response_id).additional_comment %> </td>
              <% end %>
            </tr>
          </table>
      </tr>

    </table>

<% end #loop for keys %>
<br/>